# SPDX-FileCopyrightText: 2024 Digg - The Agency for Digital Government
#
# SPDX-License-Identifier: CC0-1.0

name: Release Workflow

on:
  push:
    tags:
      - "v[0-9]*.[0-9]*" # Forces at least vX.Y and then allows anything after

permissions:
  contents: read

jobs:
  release:
    permissions:
      contents: write
      packages: write
      id-token: write
      actions: read   # Required for SLSA provenance v2
      security-events: write
    secrets: inherit
    uses: diggsweden/.github/.github/workflows/release-orchestrator.yml@feat/ci-refactor
    with:
      # Project configuration
      projectType: maven
      releaseType: stable
      
      # Version and changelog - same as before
      skipVersionBump: false
      changelogConfig: ".github-templates/gitcliff-templates/keepachangelog.toml"
      
      # Maven publishing - preserving existing behavior
      skipArtifactPublish: false
      artifactRegistry: github
      
      # Container image - preserving all existing features
      skipContainerPublish: false
      containerRegistry: ghcr.io
      containerPlatforms: "linux/amd64,linux/arm64"
      containerEnableSLSA: true  # Preserving SLSA provenance
      containerfile: Containerfile
      
      # GitHub Release - using JReleaser to preserve existing setup
      skipGitHubRelease: false
      useJReleaser: true  # Preserving JReleaser functionality
      jreleaserConfig: jreleaser.yml
      generateSBOM: true  # Already configured in jreleaser.yml
      signArtifacts: true  # Already using GPG signing
      attachArtifacts: "target/*.jar"
      
      # Java configuration
      javaVersion: "21"
